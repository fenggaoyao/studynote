(()=>{"use strict";var e={d:(t,o)=>{for(var r in o)e.o(o,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:o[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{Ostrich:()=>s});const o={getFileType:(e,t)=>{if(e)switch(e){case"jpg":case"jpeg":case"png":case"gif":case"webp":case"svg":case"ico":return"image";case"js":return"js";case"css":return"css";case"html":return"html";case"woff":case"woff2":case"ttf":case"eot":case"otf":return"font";case"swf":return"flash";case"map":return"source-map"}if(t)switch(t){case"xmlhttprequest":return"ajax";case"img":return"image";case"script":return"js";case"internal":case"iframe":return"html";default:return"other"}return t},getRandomColor:(e,t,o)=>{const r=[e||"0123456789ABCDEF",t||"0123456789ABCDEF",o||"0123456789ABCDEF"];let n="#",s=0;for(let e=0;e<6;e++)s=Math.floor(e/2),n+=r[s].split("")[Math.floor(Math.random()*r[s].length)];return n},endsWith:(e,t)=>-1!==e.indexOf(t,e.length-t.length)};o.getInitiatorOrFileTypeColour=(e,t,o)=>{let r=t||"#bebebe";switch(e){case"css":r="#afd899";break;case"iframe":case"html":r="#85b3f2";break;case"img":case"image":r="#bc9dd6";break;case"script":case"js":r="#e7bd8c";break;case"link":r="#89afe6";break;case"swf":r="#4db3ba";break;case"font":r="#e96859";break;case"xmlhttprequest":case"ajax":r="#e7d98c"}return!0===o?((e,t)=>"#"+(parseInt(e.substr(1,2),16)+t).toString(16)+(parseInt(e.substr(3,2),16)+t).toString(16)+(parseInt(e.substr(5,2),16)+t).toString(16))(r,-5):r},o.getItemCount=(e,t)=>{let o,r={},n=[];e.forEach((e=>{r[e]=r[e]?r[e]+1:1}));for(let e in r)o={},o[t||"key"]=e,o.count=r[e],n.push(o);return n.sort(((e,t)=>e.count<t.count?1:-1))},o.clone=e=>{let t;if(null==e||"object"!=typeof e)return e;if(e instanceof Date)return t=new Date,t.setTime(e.getTime()),t;if(e instanceof Array){t=[];for(let r=0,n=e.length;r<n;r++)t[r]=o.clone(e[r]);return t}if(e instanceof Object){t={};for(let r in e)e.hasOwnProperty(r)&&(t[r]=o.clone(e[r]));return t}throw new Error("Unable to helper.clone obj")};const r=o;class n{constructor(e){this.options=e,this.waitToSend=!1}extractData(){let e={};if(window.performance&&void 0!==window.performance.getEntriesByType)e.resources=window.performance.getEntriesByType("resource"),e.marks=window.performance.getEntriesByType("mark"),e.measures=window.performance.getEntriesByType("measure");else{if(!window.performance||void 0===window.performance.webkitGetEntriesByType)return console.log("您的浏览器不支持window performance"),!1;e.resources=window.performance.webkitGetEntriesByType("resource"),e.marks=window.performance.webkitGetEntriesByType("mark"),e.measures=window.performance.webkitGetEntriesByType("measure")}return window.performance.timing?(e.perfTiming=window.performance.timing,e):(console.log("您的浏览器不支持performance timing"),!1)}caculateResource(e){e.allResourcesCalc=e.resources.map(((e,t,o)=>{let n,s,a;0===e.name.indexOf("http")?(n=e.name.match(/:\/\/(.[^/]+)([^?]*)\??(.*)/),s=n[2].split("/").pop(),a=s.substr((Math.max(0,s.lastIndexOf("."))||1/0)+1)):(n=["",location.host],a=e.name.split(":")[0]);const i={name:e.name,domain:n[1],initiatorType:e.initiatorType||a||"SourceMap or Not Defined",fileExtension:a||"XHR or Not Defined",loadtime:e.duration,fileType:r.getFileType(a,e.initiatorType),isRequestToHost:n[1]===location.host};for(let t in e)"function"!=typeof e[t]&&(i[t]=e[t]);return e.requestStart&&(i.requestStartDelay=e.requestStart-e.startTime,i.dns=e.domainLookupEnd-e.domainLookupStart,i.tcp=e.connectEnd-e.connectStart,i.ttfb=e.responseStart-e.startTime,i.requestDuration=e.responseStart-e.requestStart),e.secureConnectionStart&&(i.ssl=e.connectEnd-e.secureConnectionStart),i}))}calculateRequest(e){e.requestsOnly=e.allResourcesCalc.filter((e=>0===e.name.indexOf("http")&&!e.name.match(/js.map$/))),e.initiatorTypeCounts=r.getItemCount(e.requestsOnly.map(((e,t,o)=>e.initiatorType||e.fileExtension)),"initiatorType"),e.initiatorTypeCountHostExt=r.getItemCount(e.requestsOnly.map(((e,t,o)=>(e.initiatorType||e.fileExtension)+" "+(e.isRequestToHost?"(host)":"(external)"))),"initiatorType"),e.requestsByDomain=r.getItemCount(e.requestsOnly.map(((e,t,o)=>e.domain)),"domain"),e.fileTypeCountHostExt=r.getItemCount(e.requestsOnly.map(((e,t,o)=>e.fileType+" "+(e.isRequestToHost?"(host)":"(external)"))),"fileType"),e.fileTypeCounts=r.getItemCount(e.requestsOnly.map(((e,t,o)=>e.fileType)),"fileType");const t={};e.requestsOnly.forEach((o=>{const r=e.requestsByDomain.filter((e=>e.domain==o.domain))[0]||{},n=t[o.domain]||0;o.duration=r.duration||o.responseEnd-o.startTime,n<=o.startTime?r.durationTotalParallel=(r.durationTotalParallel||0)+o.duration:n<o.responseEnd&&(r.durationTotalParallel=(r.durationTotalParallel||0)+(o.responseEnd-n)),t[o.domain]=o.responseEnd||0,r.durationTotal=(r.durationTotal||0)+o.duration})),e.hostRequests=e.requestsOnly.filter((e=>e.domain===location.host)).length,e.currAndSubdomainRequests=e.requestsOnly.filter((e=>e.domain.split(".").slice(-2).join(".")===location.host.split(".").slice(-2).join("."))).length,e.crossDocDomainRequests=e.requestsOnly.filter((e=>!r.endsWith(e.domain,document.domain))).length,e.hostSubdomains=e.requestsByDomain.filter((e=>r.endsWith(e.domain,location.host.split(".").slice(-2).join("."))&&e.domain!==location.host)).length}caculateSlowest(e){e.slowestCalls=[],e.average=void 0,e.allResourcesCalc.length>0&&(e.slowestCalls=e.allResourcesCalc.filter((e=>e.name!==location.href)).sort(((e,t)=>t.duration-e.duration)),e.average=Math.floor(e.slowestCalls.reduceRight(((e,t)=>"number"!=typeof e?e.duration+t.duration:e+t.duration))/e.slowestCalls.length))}calculatePerfTiming(e){const t=e.perfTiming.navigationStart,o={pageLoadTime:e.perfTiming.loadEventEnd-e.perfTiming.navigationStart,output:[]};for(let r in e.perfTiming)e.perfTiming[r]&&"number"==typeof e.perfTiming[r]&&(o[r]=e.perfTiming[r]-t,o.output.push({name:r,"time (ms)":e.perfTiming[r]-t}));o.output.sort(((e,t)=>(e["time (ms)"]||0)-(t["time (ms)"]||0))),e.perfTimingCalc=o}start(){"complete"!==document.readyState?(this.waitToSend=!0,window.onload=()=>{this.waitToSend&&(this.waitToSend=!1,this.reportData())}):(this.waitToSend=!1,this.reportData())}reportData(){let e=this.extractData();this.calculatePerfTiming(e),this.caculateResource(e),this.calculateRequest(e),this.caculateSlowest(e);const t=this.options.url;let{sampleRate:o}=this.options.performance,r={marks:e.marks,measures:e.measures,perfTimingCalc:e.perfTimingCalc,allResourcesCalc:e.allResourcesCalc,requestsOnly:e.requestsOnly,initiatorTypeCounts:e.initiatorTypeCounts,initiatorTypeCountHostExt:e.initiatorTypeCountHostExt,requestsByDomain:e.requestsByDomain,fileTypeCountHostExt:e.fileTypeCountHostExt,fileTypeCounts:e.fileTypeCounts,hostRequests:e.hostRequests,currAndSubdomainRequests:e.currAndSubdomainRequests,crossDocDomainRequests:e.crossDocDomainRequests,hostSubdomains:e.hostSubdomains,slowestCalls:e.slowestCalls,average:e.average};console.log(r),Math.random()<o&&function(e,t){navigator.sendBeacon?navigator.sendBeacon(e,t):fetch(e,{body:JSON.stringify(t),cache:"no-cache",credentials:"include",headers:{"content-type":"application/json",connection:"keep-alive"},method:"POST",mode:"cors",referrer:"client"})}(t,r)}}class s{constructor(e){if(!e.url)throw new Error("参数数据，url为必填项");this.options=Object.assign({url:"",performance:{sampleRate:1},error:{},event:{}},e)}start(){this.options.performance&&new n(this.options).start(this.options)}}var a=window;for(var i in t)a[i]=t[i];t.__esModule&&Object.defineProperty(a,"__esModule",{value:!0})})();
//# sourceMappingURL=index.js.map